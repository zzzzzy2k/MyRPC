## v1.0

创建maven项目MyRPC

删除src文件夹

依次创建maven项目：rpc-api，rpc-common，rpc-core，test-client，test-server

### rpc-api

**接口依赖**

编写简单的对象并使用Java原生序列化：HelloObject implement Serializable

编写简单的接口：HelloService

### rpc-common

**通用依赖**

common里面有实体包（entity）和枚举包（enumeration）

在实体类中编写rpc请求和响应类

请求类包括：
- 需要调用的接口名称
- 需要调用的方法名称
- 需要调用的方法的参数
- 需要调用的方法的参数类型

响应类包括：
- 状态码
- 状态码补充的信息
- 需要响应的数据
- 对应成功或失败的方法，如果成功，则需要返回数据；失败，则返回失败的原因

对于响应的状态码和状态码补充的信息，这里用枚举类来返回。

### rpc-core

**核心依赖**

核心主要分为两大类，一类是客户端，一类是服务端。

**1、建立服务端**

- 服务器建立通信 ServerSocket ，并设置端口

- 服务器建立 Socket 接收客户端连接，不断进行监听

- 监听到客户端后，可以建立 IO 输入流读取客户端发送地数据，也可以建立IO输出流向客户端发送数据消息。

- 这里我们建立线程池，为每一个用户地连接建立一个工作线程

  复习一下线程池的参数：

  1. 核心线程数
  2. 最大线程数
  3. 空闲线程存活时间
  4. 存活时间单位
  5. 工作队列
  6. 线程工厂

- 在工作线程对象WorkerThread中，实现Runnable接口，通过class.getMethod方法，获得Method对象。再通过反射，method.invoke方法，传入对象实例和方法参数，即可调用并获得返回值。

**2、建立客户端**

- 创建 Socket 通行，设置通信服务器的 IP 地址和 Port 端口
- 建立 IO 输出流向服务器发送数据消息，然后建立 IO 输入流读取服务器发送来的数据消息。

由于客户端这一侧没有接口的具体实现类，就没有办法直接生成实例对象。所以我们采用动态代理的方式生成实例，并且调用方法时生成需要的 RpcRequest 对象并发送给服务端。

这里采用 JDK 动态代理，代理类是需要实现 `InvocationHandler` 接口的。

使用 getProxy() 方法来生成代理对象。

`InvocationHandler`接口需要实现invoke()方法，来**指明代理对象的方法被调用时的动作**。我们需要生成一个RpcRequest对象，这里使用Builder模式生成RpcRequest对象。然后再使用一个RpcClient对象来实现发送，然后返回从服务端接收到的结果即可。

### 测试

最后就是客户端和服务端的测试类啦！

#### test-server

在服务端这边，首先是对接口的实现，创建一个接口的实现类，简单实现一下，返回一个字符串。

接口实现后，创建一个相应接口的实例和RpcServer的实例对象，然后通过RpcServer的实例对象将接口的实例注册进去就行啦！

#### test-client

客户端先通过host和port，创建一个代理对象，并调用代理对象，然后动态代理会自动帮我们向服务端发送请求。
